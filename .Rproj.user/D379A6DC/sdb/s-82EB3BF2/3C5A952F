{
    "collab_server" : "",
    "contents" : "---\ntitle: \"IDA Use Case\"\noutput: github_document\nhtml_document:\n  df_print: paged\n  keep_md: true\n  code_fold: hide\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set( message=F, warning=F, fig.width = 10, fig.height = 10 )\nlibrary(dplyr)\nlibrary(pander)\nsetwd(\"C:/Users/icps/Dropbox/3. Maxwell/4. Capston\")\n\n#Two DF manually downloaded from usapspending.gov\n\n#Formatting the contracts DF\ncnt <- read.csv(\"./Data/NYcon2017.csv\", stringsAsFactors = F)\n#making naics code two digit\ncnt$NAICS.code <- as.integer(substring(cnt$principalnaicscode, 1,2))\n#adding the name variable\nnaics <- read.csv(\"./Data/NAICS_cat.csv\")\nx <- match(cnt$NAICS.code, naics$X2017.NAICS.Code)\ncnt$NAICS.name <- as.character(naics$X2017.NAICS.Title[x])\n\n#Formatting the grants DF\ngra17 <- read.csv(\"./Data/NYgra2017.csv\", stringsAsFactors = F)\ngra16 <- read.csv(\"./Data/NYgra2016.csv\", stringsAsFactors = F)\ngra15 <- read.csv(\"./Data/NYgra2015.csv\", stringsAsFactors = F)\ngra14 <- read.csv(\"./Data/NYgra2014.csv\", stringsAsFactors = F)\n\nsetwd(\"C:/Users/icps/Dropbox/3. Maxwell/4. Capston/Data-Capstone/ignacio\")\n\n```\n\n\n#Use case\n\n* **Position**: Howard Zemsky president and CEO of Empire State Development\n* **Organization**: Empire State Development\n* **Location**: NY\n* **Sector**: Local Government (State)\n* **Interest/question**: Wants to know which cities in their state are missing out on potential funds that they could apply for and needs a breakdown of per capita federal spending in each city to assess areas of need.\n \nIn what follows I will elaborate comparisons between Rochester and Syracuse\n \n#Main Recipients of Fed $\n\n##Syracuse\n```{r}\n#Subsetting sry16\nx <- gra16$recipient_city_name %in% c(\"Syracuse\", \"SYRACUSE\")\n\nsyr16 <- gra16[x,c(\"maj_agency_cat\", \"agency_name\", \"action_type\",\n               \"cfda_program_num\", \"cfda_program_title\", \"fed_funding_amount\", \"non_fed_funding_amount\",\n               \"total_funding_amount\",\t\"asst_cat_type\", \"assistance_type\", \"record_type\",\n               \"fiscal_year\", \"principal_place_cc\", \"project_description\", \"recipient_name\", \n               \"recipient_type\", \"recip_cat_type\", \"recipient_city_name\", \"recipient_county_name\",\n               \"recipient_state_code\", \"exec1_fullname\", \"exec1_amount\")]\n\n#exploring\n\n#what type of assistances are they getting?\n#unique(syr16$asst_cat_type)\n#[1] \"G\"\n\n#unique(syr16$assistance_type)\n#[1] \"04: Project grant\"         \"03: Formula grant\"         \"05: Cooperative agreement\"\n\n#ass <- group_by(syr16, assistance_type)\n#ass <- arrange(as.data.frame(summarize(ass, Freq = n())), desc(Freq))\n#            assistance_type Freq\n#1         04: Project grant  208\n#2 05: Cooperative agreement   34\n#3         03: Formula grant    4\n\n#action_type: The type of action for the record: whether it is a new assistance action, a continuation, a revision, or a funding adjustment.\n\nunique(syr16$action_type) #character type\n\n#Only interested in pure Federal grants\nx <- syr16$non_fed_funding_amount == 0\nsyr16 <- syr16[x,]\n\n#only interested in project grants\nx <- syr16$assistance_type == \"04: Project grant\"\nsyr16 <- syr16[x,]\n\n#should we also be interested in only one particular action? \n#I will agregate all types because if something adds or reduces its better to have it all summed up.\n\n```\n\n###Main Recipients\n```{r}\n#Main recipients at syr\noptions(scipen = 999)\nrec <- group_by(syr16, recipient_name)\nrec <- arrange(as.data.frame(summarize(rec, Fed = sum(fed_funding_amount), Freq = n())), desc(Fed))\n\n#removing negatives\nx <- rec$Fed < 0 \nrec$Fed[x] <- 0\nrec <- arrange(rec, desc(Fed))\n\n#printing head\nhead(rec) %>% pander\n\n#barplot\npar(mar = c(7,6,3,3), mfrow=c(1,1))\nbarplot(rec$Fed/1000000, names.arg = rec$recipient_name, las = 2, cex.names = .7, cex.axis = .7 , ylab = \"in USD 1MLL\", cex.lab = .8)\n\n#creating an object for a pie charts for the 5 mayor recipients\npie <- rec[1:5,]\npie[6,] <- c(\"OTHERS\", sum(rec$Fed[6:length(rec$Fed)]), sum(rec$Freq[6:length(rec$Fed)])) \npie$Fed <- as.numeric(pie$Fed)\npie <- arrange(pie, desc(Fed))\npie.syr.rec <- pie\n\n```\n\n##Rochester\n\n```{r}\n#Subsetting Rochester\nx <- gra16$recipient_city_name %in% c(\"Rochester\", \"ROCHESTER\")\n\nroc16 <- gra16[x,c(\"maj_agency_cat\", \"agency_name\", \"action_type\",\n               \"cfda_program_num\", \"cfda_program_title\", \"fed_funding_amount\", \"non_fed_funding_amount\",\n               \"total_funding_amount\",\t\"asst_cat_type\", \"assistance_type\", \"record_type\",\n               \"fiscal_year\", \"principal_place_cc\", \"project_description\", \"recipient_name\", \n               \"recipient_type\", \"recip_cat_type\", \"recipient_city_name\", \"recipient_county_name\",\n               \"recipient_state_code\", \"exec1_fullname\", \"exec1_amount\")]\n\n#Only interested in pure Federal grants\nx <- roc16$non_fed_funding_amount == 0\nroc16 <- roc16[x,]\n\n#only interested in project grants\nx <- roc16$assistance_type == \"04: Project grant\"\nroc16 <- roc16[x,]\n```\n\n###Main Recipients\n```{r}\n#Main recipients in ROCHESTER\nrec <- group_by(roc16, recipient_name)\nrec <- arrange(as.data.frame(summarize(rec, Fed = sum(fed_funding_amount), Freq = n())), desc(Fed))\n\n#removing negatives\nx <- rec$Fed < 0 \nrec$Fed[x] <- 0\nrec <- arrange(rec, desc(Fed))\n\n#printing head\nhead(rec) %>% pander\n\n#barplot\npar(mar = c(7,6,3,3), mfrow=c(1,1))\nbarplot(rec$Fed/1000000, names.arg = rec$recipient_name, las = 2, cex.names = .7, cex.axis = .7 , ylab = \"in USD 1MLL\", cex.lab = .8)\n\n#creating an object for the pie chart of only 5 mayor recipients\npie <- rec[1:5,]\npie[6,] <- c(\"OTHERS\", sum(rec$Fed[6:length(rec$Fed)]), sum(rec$Freq[6:length(rec$Fed)])) \npie$Fed <- as.numeric(pie$Fed)\npie <- arrange(pie, desc(Fed))\npie.roc.rec <- pie\n\n```\n\n##Comparing Top 5 Recipients in Syr and Roc\n\n```{r}\n#pie charts!\ncol <- c(\"#4979FF\", \"#FF9858\",  \"#8DFFFF\", \"#FF84FF\", \"#55D473\", \"#FFFF78\")\n\nplot.new()\npar(mfrow = c(1,2), mar=c(0,0,3,0))\n\npie<- pie.syr.rec\npie(as.numeric(pie$Fed), labels = paste0(pie$recipient_name, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 5 Recipients of Fed $ in Syracuse\", cex= .7, col=col)\n\npie<- pie.roc.rec\npie(as.numeric(pie$Fed), labels = paste0(pie$recipient_name, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 5 Recipients of Fed $ in Rochester\", cex= .7, col=col)\n\n```\n\n#Main Fed Agencies and Programs that give funding\n\n##Syracuse\n\n###Agencies\n```{r}\n#Syracuse\n\n#First by Agencies\ndat <- group_by(syr16, agency_name)\ndat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount), Freq = n())), desc(Fed))\n\n#pie chart only 5 mayor recipients\npie <- dat[1:5,]\npie[6,] <- c(\"OTHERS\", sum(dat$Fed[6:length(dat$Fed)]), sum(dat$Freq[6:length(dat$Fed)])) \npie$Fed <- as.numeric(pie$Fed)\npie <- arrange(pie, desc(Fed))\npie.syr.age <- pie\n\n#removing negatives\nx <- dat$Fed < 0 \ndat$Fed[x] <- 0\ndat <- arrange(rec, desc(Fed))\n\n#printing head\nhead(dat) %>% pander\n\n#barplot\npar(mar = c(7,6,3,3), mfrow=c(1,1))\nbarplot(dat$Fed/1000000, names.arg = dat$recipient_name, las = 2, cex.names = .7, cex.axis = .7 , ylab = \"in USD 1MLL\", cex.lab = .8)\n\n```\n\n###Programs\n```{r}\n#Main programs\ndat <- group_by(roc16, cfda_program_title)\ndat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount), Freq = n())), desc(Fed))\n\npie <- dat[1:10,]\npie[11,] <- c(\"OTHERS\", sum(dat$Fed[11:length(dat$Fed)]), sum(dat$Freq[11:length(dat$Fed)])) \npie$Fed <- as.numeric(pie$Fed)\npie <- arrange(pie, desc(Fed))\npie.syr.pro <- pie\n\n#removing negatives\nx <- dat$Fed < 0 \ndat$Fed[x] <- 0\ndat <- arrange(rec, desc(Fed))\n\n#printing head\nhead(dat) %>% pander\n\n#barplot\npar(mar = c(7,6,3,3), mfrow=c(1,1))\nbarplot(dat$Fed/1000000, names.arg = dat$recipient_name, las = 2, cex.names = .7, cex.axis = .7 , ylab = \"in USD 1MLL\", cex.lab = .8)\n\n```\n\n\n##Comparing Top Funding Agencies and Programs in Syr and Roc\n\n```{r}\n#plotting both pies\n\npar(mfrow=c(2,1), mar=c(0,0,3,0))\npie <- pie.syr.age\npie(as.numeric(pie$Fed), labels = paste0(pie$agency_name, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 5 Agencies of Fed $ in Syracuse\", cex= .7, col=col)\n\npie <- pie.syr.pro\npie(as.numeric(pie$Fed), labels = paste0(pie$cfda_program_title, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 10 Programs of Fed $ in Syracuse\", cex= .7, col=col)\n\n```\n\n##Rochester\n\n###Agencies\n```{r}\n#ROCHESTER\n\n#First by Agencies\ndat <- group_by(roc16, agency_name)\ndat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount), Freq = n())), desc(Fed))\n\n#pie chart only 5 mayor recipients\npie <- dat[1:5,]\npie[6,] <- c(\"OTHERS\", sum(dat$Fed[6:length(dat$Fed)]), sum(dat$Freq[6:length(dat$Fed)])) \npie$Fed <- as.numeric(pie$Fed)\npie <- arrange(pie, desc(Fed))\npie.roc.age <- pie\n\n#removing negatives\nx <- dat$Fed < 0 \ndat$Fed[x] <- 0\ndat <- arrange(rec, desc(Fed))\n\n#printing head\nhead(dat) %>% pander\n\n#barplot\npar(mar = c(7,6,3,3), mfrow=c(1,1))\nbarplot(dat$Fed/1000000, names.arg = dat$recipient_name, las = 2, cex.names = .7, cex.axis = .7 , ylab = \"in USD 1MLL\", cex.lab = .8)\n\n############################\n```\n\n###Programs\n```{r}\n\n#Main programs\ndat <- group_by(roc16, cfda_program_title)\ndat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount), Freq = n())), desc(Fed))\n\npie <- dat[1:10,]\npie[11,] <- c(\"OTHERS\", sum(dat$Fed[11:length(dat$Fed)]), sum(dat$Freq[11:length(dat$Fed)])) \npie$Fed <- as.numeric(pie$Fed)\npie <- arrange(pie, desc(Fed))\npie.roc.pro <- pie\n\n#removing negatives\nx <- dat$Fed < 0 \ndat$Fed[x] <- 0\ndat <- arrange(rec, desc(Fed))\n\n#printing head\nhead(dat) %>% pander\n\n#barplot\npar(mar = c(7,6,3,3), mfrow=c(1,1))\nbarplot(dat$Fed/1000000, names.arg = dat$recipient_name, las = 2, cex.names = .7, cex.axis = .7 , ylab = \"in USD 1MLL\", cex.lab = .8)\n\n############################\n\n#plotting both pies\n\npar(mfrow=c(2,1), mar=c(0,0,3,0))\npie <- pie.roc.age\npie(as.numeric(pie$Fed), labels = paste0(pie$agency_name, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 5 Agencies of Fed $ in Rochester\", cex= .7, col=col)\n\npie <- pie.roc.pro\npie(as.numeric(pie$Fed), labels = paste0(pie$cfda_program_title, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 10 Programs of Fed $ in Rochester\", cex= .7, col=col)\n\n\n\n```\n\n###Comparable Pie charts for Agencies and Programs in both Syr and Roc\n\n```{r}\n#all four \npar(mfrow=c(2,2), mar=c(0,0,3,0))\npie <- pie.syr.age\npie(as.numeric(pie$Fed), labels = paste0(pie$agency_name, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 5 Agencies of Fed $ in Syracuse\", cex= .7, col=col)\n\npie <- pie.syr.pro\npie(as.numeric(pie$Fed), labels = paste0(pie$cfda_program_title, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 10 Programs of Fed $ in Syracuse\", cex= .7, col=col)\n\npie <- pie.roc.age\npie(as.numeric(pie$Fed), labels = paste0(pie$agency_name, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 5 Agencies of Fed $ in Rochester\", cex= .7, col=col)\n\npie <- pie.roc.pro\npie(as.numeric(pie$Fed), labels = paste0(pie$cfda_program_title, \"\\n\" , round(pie$Fed/sum(pie$Fed)*100, digits=1), \"%\"), main = \"Top 10 Programs of Fed $ in Rochester\", cex= .7, col=col)\n\n```\n\n\n\n\n \n \n \n \n \n \n \n**Dataset**:\n \n**Relevant Variables**:\n \n**Description of Analysis**:\n \n**Coded Tools needed**:\n \n**Visualizations**:\n \n**Journey map**:\n \n**Final insights/answers to the interest/question/other added value**:\n \n**Limitations/further work**:\n\n\n\n",
    "created" : 1496328262101.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "974113635",
    "id" : "3C5A952F",
    "lastKnownWriteTime" : 1496344587,
    "last_content_update" : 1496344587732,
    "path" : "C:/Users/icps/Dropbox/3. Maxwell/4. Capston/Data-Capstone/Ignacio/IDAuc.Rmd",
    "project_path" : "Ignacio/IDAuc.Rmd",
    "properties" : {
        "chunk_output_type" : "console",
        "content_preview_inline" : "false",
        "last_setup_crc32" : "A0E03E60cdb7c87",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}