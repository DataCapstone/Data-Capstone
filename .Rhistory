theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
labs(title="Federal Funding by Recipient types in NY",
subtitle = "This is a subtitle",
caption = "This is a caption")+
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle("Composition of Exports to China (%)") +
labs(title="Federal Funding by Recipient types in NY",
subtitle = "This is a subtitle",
caption = "This is a caption")+
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle("Composition of Exports to China (%)") +
labs(title="Federal Funding by Recipient types in NY",
subtitle = "This is a subtitle",
caption = "This is a caption")+
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
labs(title="Federal Funding by Recipient types in NY",
subtitle = "This is a subtitle",
caption = "This is a caption")+
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle(label="Federal Funding by Recipient type in NY")
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle(label="Federal Funding by Recipient type in NY") +
#labs(title="Federal Funding by Recipient type in NY",
#    subtitle = "This is a subtitle",
#   caption = "This is a caption")+
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle(label="Federal Funding by Recipient type in NY") +
labs(title="Federal Funding by Recipient type in NY",
subtitle = "This is a subtitle",
caption = "This is a caption")+
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle(label="Federal Funding by Recipient type in NY") +
labs(title="Federal Funding by Recipient type in NY")+
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle(label="Federal Funding by Recipient type in NY") +
labs(title="Federal Funding by Recipient type in NY")+
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle(label="Main Federal Funding Agencies in NY") +
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
dat <- group_by(gra16, maj_agency_cat)
dat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount))), desc(Fed))
dat$fraction <- dat$Fed / sum(dat$Fed)
dat$ymax <- cumsum(dat$fraction)
dat$ymin <- c(0, head(dat$ymax, n=-1)) #-1 means all but number 1. is the compliment
dat$mid <- dat$ymin + (dat$ymax - dat$ymin)/2
dat <- group_by(gra16, maj_agency_cat)
dat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount))), desc(Fed))
#making an others category
dat[6,] <- c("Others", sum(dat$Fed[6:length(dat$Fed)]), sum(dat$Freq[6:length(dat$Fed)]))
dat <- dat[-c(1:6),]
dat$Fed <- as.numeric(dat$Fed)
dat <- arrange(dat, desc(Fed))
dat <- group_by(gra16, maj_agency_cat)
dat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount))), desc(Fed))
#making an others category
dat[6,] <- c("Others", sum(dat$Fed[6:length(dat$Fed)]), sum(dat$Freq[6:length(dat$Fed)]))
dat <- group_by(gra16, maj_agency_cat)
dat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount))), desc(Fed))
length(dat$Fed)
dat[6,] <- c("Others", sum(dat$Fed[6:length(dat$Fed)]), sum(dat$Freq[6:length(dat$Fed)]))
dat
dat <- group_by(gra16, maj_agency_cat)
dat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount))), desc(Fed))
dat[6,] <- c("Others", sum(dat$Fed[6:length(dat$Fed)]))
dat
dat <- dat[-c(1:6),]
dat
dat <- dat[!c(1:6),]
dat <- group_by(gra16, maj_agency_cat)
dat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount))), desc(Fed))
#making an others category
dat[6,] <- c("Others", sum(dat$Fed[6:length(dat$Fed)]))
dat <- dat[!c(1:6),]
dat
dat
dat <- group_by(gra16, maj_agency_cat)
dat <- arrange(as.data.frame(summarize(dat, Fed = sum(fed_funding_amount))), desc(Fed))
#making an others category
dat[6,] <- c("Others", sum(dat$Fed[6:length(dat$Fed)]))
dat <- dat[c(1:6),]
dat
dat$Fed <- as.numeric(dat$Fed)
dat <- arrange(dat, desc(Fed))
dat
dat$fraction <- dat$Fed / sum(dat$Fed)
dat$ymax <- cumsum(dat$fraction)
dat$ymin <- c(0, head(dat$ymax, n=-1)) #-1 means all but number 1. is the compliment
dat$mid <- dat$ymin + (dat$ymax - dat$ymin)/2
dat
pie <- ggplot(dat,
aes(fill=recip_cat_type,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle(label="Main Federal Funding Agencies in NY") +
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
pie <- ggplot(dat,
aes(fill=maj_agency_cat,
xmax=3, xmin=2, #only one bar from 3 to 4 in the x axis.
ymax=ymax, ymin=ymin)) +  #look at the df and see these values represent the stacks.
xlim(c(0, 4)) + #sets the x limints, which in this case is the radius
geom_rect(colour="white", #makes the border of the rectangles white.
size = 1.5) + #size of the border
coord_polar(theta="y") + #makes the bars start at 12 o clock vertically and then bars grow cirularly, like a race track.
geom_text(aes(x= 2.5, y = mid, label = paste0(round(fraction*100, digits = 1),"%")),
size=4,
fontface = "bold",
hjust = .5,
vjust = .5,
colour = "white") +
ggtitle(label="Main Federal Funding Agencies in NY") +
theme_bw() + #eliminates the background
theme(panel.grid=element_blank(), #eliminates the grid.
axis.text=element_blank(), #eliminates the text of axis. note that the x axis is the radius from the center to 12 o clock and that y axis is the whole cirumference, starting at 12 o clock.
axis.ticks=element_blank(),
axis.title = element_blank(),
panel.border = element_blank(),
plot.margin = margin(0,0,0,0, "cm"),
legend.margin = margin(0,0,0,0, "cm"),
legend.title = element_blank(),
legend.position = "right",
legend.text = element_text(colour = "grey40", size = 8))
pie
source_github <- function( url ) {
# load package
require(RCurl)
# read script lines from website and evaluate
script <- getURL(url, ssl.verifypeer = FALSE)
eval(parse(text = script), envir=.GlobalEnv)
}
#load the donutzz function using the RAW link
source_github("https://raw.githubusercontent.com/icps86/Functions/master/donutzz.R")
x <- data.frame(MGenre = c("Medieval Metal", "Doom Metal", "Symbolic Metal", "Metal Metal", "Mathematical metal"), Fans  = c(40, 90, 10, 20, 80), row.names = NULL)
x
donutzz(x = x$Fans, lev = x$MGenre, main = "Composition of Thematic Metal Fans in Iowa" )
# Download the data, clean
gra16.named <- readRDS(gzcon(url("https://github.com/DataCapstone/Data-Capstone/blob/master/Raw-Data/NYgra16_counties_named.rds?raw=true")))
codes <- read.csv("https://raw.githubusercontent.com/DataCapstone/Data-Capstone/master/Raw-Data/countycodesNY.csv")
gra16.without.state <- filter(gra16.named , recipient_type != "00: State government")
gra16.2 <- mutate(gra16.without.state, county = as.character(Name))
gra16.3 <- gra16.2[ c("recipient_name" , "recipient_county_code", "county" , "recipient_type" , "fed_funding_amount" , "assistance_type" , "cfda_program_title" , "agency_name" ) ]
#Load the population data
censuskey <- "cc0582f55dc6c9f75f5ea92824c86e0ae5d0d5d8"
population.dat <- getCensus(name="acs5", vintage=2015, key=censuskey,
vars=c("B01001_001E"), region="county:*", regionin = "state: 36")
colnames(population.dat) <- c("state","county_code", "population")
population.dat$county_code <- as.numeric(as.character(population.dat$county_code))
population.dat.2 <- merge(population.dat , codes, by.x = "county_code", by.y = "Fips")
# Aggregation function
agg.county <- function(df , var){
ag <- aggregate(df$fed_funding_amount, by= list( df$county, var), FUN = sum  )
colnames(ag) <- c("county", "var", "fund")
return(ag)
}
# Per capita aggregation function
agg.county.percap <- function(df, df.p , var){
ag <- aggregate(df$fed_funding_amount, by= list( df$county, var), FUN = sum  )
colnames(ag) <- c("county", "var", "fund")
ag.pop <- merge(ag , df.p, by.x = "county", by.y = "Name")
ag.pop.2 <- mutate(ag.pop , percap =  fund / population )
ag.pop.3 <- ag.pop.2[c("var", "fund", "percap", "county")]
return(ag.pop.3)
}
gra16.4 <- filter(gra16.3 , county %in% c("Onondaga", "Madison") )
pop.filtered <- filter(population.dat.2 , Name %in% c("Onondaga", "Madison") )
agg.per <- agg.county.percap(gra16.4, pop.filtered, gra16.4$recipient_type)
gra16.without.state <- filter(gra16.named , recipient_type != "00: State government")
gra16.2 <- mutate(gra16.without.state, county = as.character(Name))
gra16.3 <- gra16.2[ c("recipient_name" , "recipient_county_code", "county" , "recipient_type" , "fed_funding_amount" , "assistance_type" , "cfda_program_title" , "agency_name" ) ]
#Load the population data
censuskey <- "cc0582f55dc6c9f75f5ea92824c86e0ae5d0d5d8"
population.dat <- getCensus(name="acs5", vintage=2015, key=censuskey,
vars=c("B01001_001E"), region="county:*", regionin = "state: 36")
colnames(population.dat) <- c("state","county_code", "population")
population.dat$county_code <- as.numeric(as.character(population.dat$county_code))
population.dat.2 <- merge(population.dat , codes, by.x = "county_code", by.y = "Fips")
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(pander)
library(shiny)
library(censusapi)
library(plotly)
# Download the data, clean
gra16.named <- readRDS(gzcon(url("https://github.com/DataCapstone/Data-Capstone/blob/master/Raw-Data/NYgra16_counties_named.rds?raw=true")))
codes <- read.csv("https://raw.githubusercontent.com/DataCapstone/Data-Capstone/master/Raw-Data/countycodesNY.csv")
gra16.without.state <- filter(gra16.named , recipient_type != "00: State government")
gra16.2 <- mutate(gra16.without.state, county = as.character(Name))
gra16.3 <- gra16.2[ c("recipient_name" , "recipient_county_code", "county" , "recipient_type" , "fed_funding_amount" , "assistance_type" , "cfda_program_title" , "agency_name" ) ]
#Load the population data
censuskey <- "cc0582f55dc6c9f75f5ea92824c86e0ae5d0d5d8"
population.dat <- getCensus(name="acs5", vintage=2015, key=censuskey,
vars=c("B01001_001E"), region="county:*", regionin = "state: 36")
colnames(population.dat) <- c("state","county_code", "population")
population.dat$county_code <- as.numeric(as.character(population.dat$county_code))
population.dat.2 <- merge(population.dat , codes, by.x = "county_code", by.y = "Fips")
# Aggregation function
agg.county <- function(df , var){
ag <- aggregate(df$fed_funding_amount, by= list( df$county, var), FUN = sum  )
colnames(ag) <- c("county", "var", "fund")
return(ag)
}
# Per capita aggregation function
agg.county.percap <- function(df, df.p , var){
ag <- aggregate(df$fed_funding_amount, by= list( df$county, var), FUN = sum  )
colnames(ag) <- c("county", "var", "fund")
ag.pop <- merge(ag , df.p, by.x = "county", by.y = "Name")
ag.pop.2 <- mutate(ag.pop , percap =  fund / population )
ag.pop.3 <- ag.pop.2[c("var", "fund", "percap", "county")]
return(ag.pop.3)
}
gra16.3
gra16.4 <- filter(gra16.3 , county %in% c("Onondaga", "Madison") )
pop.filtered <- filter(population.dat.2 , Name %in% c("Onondaga", "Madison") )
agg.per <- agg.county.percap(gra16.4, pop.filtered, gra16.4$recipient_type)
agg.per
donutzz(x =  agg.per$var , lev = agg.per$percap , main = "Funding by recipient")
class(x$Fans)
class(x$MGenre)
donutzz(x =  agg.per$percap , lev = agg.per$var , main = "Funding by recipient")
agg.per$var
class(agg.per$var)
as.factor(agg.per$var)
donutzz(x =  agg.per$percap , lev = as.factor(agg.per$var) , main = "Funding by recipient")
source_github <- function( url ) {
# load package
require(RCurl)
# read script lines from website and evaluate
script <- getURL(url, ssl.verifypeer = FALSE)
eval(parse(text = script), envir=.GlobalEnv)
}
#load the donutzz function using the RAW link
source_github("https://raw.githubusercontent.com/icps86/Functions/master/donutzz.R")
donutzz(x =  agg.per$percap , lev = agg.per$var , main = "Funding by recipient")
head(agg.per)
(agg.per)
ggplot(data=agg.per, aes(x=var, y=percap))
ggplot(data=agg.per, aes(x=var, y=percap)) +
geom_bar(stat="identity")
ggplot(data=agg.per, aes(x=var, y=percap)) +
geom_bar(stat="identity") +
facet_wrap(~county, ncol = 1) +
ggtitle("Multiples")
